#!/usr/bin/php
<?php
include $_ENV['MAD_BOOTSTRAP'];
$registry = madFramework::instance();

$request = new ezcMvcRequest();
$request->uri = $argv[1];
$request->protocol = 'http-get';
$request->host = trim( `hostname -f` );
$request->date = new DateTime;
$request->requestId = $request->host . $request->uri;

$routes = $registry->configuration['routes'];
$router = new madRouter( $request, $routes );
$registry->router = $router;
$routingInformation = $router->getRoutingInformation();

$controllerClass = $routingInformation->controllerClass;
$controller = new $controllerClass( $routingInformation->action, $request );
$result = $controller->createResult();

$view = new madView( $request, $result, $routingInformation );

$response = $view->createResponse();

$tmpFile = '/tmp/mad_' . mktime(  ) . '.html';

file_put_contents( $tmpFile, $response->body );

echo shell_exec( 'lynx -dump ' . $tmpFile );
